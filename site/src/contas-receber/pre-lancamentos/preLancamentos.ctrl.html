<link rel="stylesheet" href="src/contas-receber/pre-lancamentos/preLancamentos.ctrl.css">

<div class="header">
	<div header></div>
</div>

<div ng-init="ngOnInit()" class="row container-fluid ba__body-content ba__full-width">
	<div sidebar></div>
	<div class="col-xs-21 ba__admin-container">
		<div class="col-xs-24 ba__admin-container-list">
			<div class="row ba__admin-busca">
				<div class="col-xs-24 input-group ba__admin-busca-input" style="float: left; border: none!important; height: 30px; margin-left: 20px">
					<span class="input-group-addon" style="height: 60px"></span>
					<select class="form-group col-xs-3 ba__adminSelectBusca" ng-init="search.type = 'dt_base'" ng-model="search.type" style="height: 50px; border-bottom: 1px solid #cccccc;">
            <option value="dt_base">Data Base</option>
          </select>
					<div class="col-xs-7 col-xs-offset-1">
						<select class="ba__input-select" style="display: inline;width:50%;margin-top: 6px;" ng-model="search.mes" enter ng-options="meses.codigo as meses.nome for meses in data.meses">
							<option value="">Selecione o mês</option>
						</select>
						<input type="number" class="form-group col-xs-1" style="font-size: 20px;font-family:inherit;text-align: center; float: right;width: 30%;border-bottom: 1px solid #ccc;height: 49px;margin-right: 14%;"
                               placeholder="ANO" ng-model="search.ano" >
					</div>
					<button type="button" class="btn btn-primary col-xs-3 col-xs-offset-1 uppercase" style="margin-top: 12px" ng-click="pesquisar(search)" >
						Pesquisar
						<i class="icon-ba-search"></i>
          </button>
				</div>
			</div>
			<div class="row ba__admin-list">
				<div class="row ba__margin-top-20">
					<h3 class="col-md-15 Roboto-Light"><strong>{{preLancamentos.length || 0}}</strong> Pré-lançamentos</h3>

					<button type="button" class="btn btn-success col-xs-offset-3 col-xs-6 uppercase" style="margin-top: 12px" ng-click="createPreLancamento()" ng-if="accessPagina.inserir">
							Novo
						</button>
				</div>
				<div class="list-group ba__admin-table ba__margin-top-40" >
					<a class="list-group-item disabled">
						<div class="row uppercase">
							<div class="col-xs-3">Imóvel<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-6">Parceiro<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-6">Descrição<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-3">Data base<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-2">Cálculo<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-2">Valor<i class="ba__margin-horizontal-5"></i></div>
							<div class="col-xs-2 text-center">Ações<i class="ba__margin-horizontal-5"></i></div>
						</div>
					</a>
					<div class="ba__admin-table-scroll" style="height: 65%">
						<a class="list-group-item ba__font-size-12 ba__pointer" ng-repeat="preLancamento in preLancamentos" ng-click="editPreLancamento(preLancamento)">
							<div class="row">
								<div class="col-xs-3">{{'Qd ' + preLancamento.imovel.quadra + 'Lt.' + preLancamento.imovel.lote}}</div>
								<div class="col-xs-6">{{preLancamento.nome_morador}}</div>
								<div class="col-xs-6">{{preLancamento.lancamento.descricao}}</div>
								<div class="col-xs-3">{{mesExtenso(preLancamento.mes)+'/'+preLancamento.ano}}</div>
								<div class="col-xs-2">{{(preLancamento.valor_percentual ? '%' : 'R$')}}</div>
								<div class="col-xs-2">{{(preLancamento.lancamento.categoria == 7 ? '-' : '')+preLancamento.lancamento.valor | number:2}}</div>
								<div class="col-xs-2">
									<i class="icon-ba-edit ba__margin-left-35" ng-if="accessPagina.editar" title="Editar" ></i>
									<i class="icon-ba-trash ba__margin-left-20" ng-if="accessPagina.excluir" title="Excluir" ng-click="showDeleteAlert(preLancamento)"></i>
								</div>
							</div>
						</a>
					</div>
					<div class="col-md-10 col-md-offset-9" ng-if="pageCount">
						<nav class="">
							<ul class="pagination text-center" style="margin:inherit">
								<li>
									<a aria-label="Previous" ng-click="updateList(current_page - 1)" class="ba__margin-right-15">
										<span aria-hidden="true">&laquo; ANTERIOR</span>
									</a>
								</li>
								<li ng-click="updateList(page)" ng-repeat="page in pages">
									<a ng-class="page == current_page ? 'selected' : ''">{{page}}</a>
								</li>
								<li ng-if="pageCount > 5">
									<a>...</a>
								</li>
								<li ng-if="pageCount > 5" ng-click="updateList(pageCount)">
									<a ng-class="pageCount == current_page ? 'selected' : ''">{{pageCount}}</a>
								</li>
								<li>
									<a aria-label="Next" ng-click="updateList(current_page + 1)" style="margin-left: 15px">
										<span aria-hidden="true">PRÓXIMA &raquo;</span>
									</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--MODAL CADASTRAR PRE LANÇAMENTO-->
<div ng-keypress="$event.keyCode == 13 && savePreLancamento();" class="modal fade" id="novoPreLancamento" tabindex="-1" role="dialog">
	<div class="modal-dialog ba__modal-lancamento-avulso" role="document">
		<div class="modal-content" style="height: 700px">
			<div class="modal-header ba__no-padding-top">
				<h4 class="col-xs-21 modal-title Roboto-Thin ba__font-size-25">
					<i class="icon-ba-attention text-center text-primary ba__margin-horizontal-5"></i>
					<span>{{preLancamentoSelecionado.id_lancamento ? 'Editar' : 'Novo'}}</span>
					<!--<span>Editando tipo de lançamento</span>-->
				</h4>
			</div>
			<div class="modal-body ba__modal-body-tipo-lancamento ba__margin-top-7">
				<form>
					<div class="row">
						<div class="form-group col-xs-24" id="lancamentos">
							<div class="row ba__margin-bottom-30" ng-show="preLancamentoSelecionado.id_lancamento">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Código</h5>
								</div>
								<div class="col-md-4 col-md-offset-1">
									<input type="text" class="ba__input-modal" ng-model="preLancamentoSelecionado.id_lancamento" style="text-transform:uppercase; height: 60px; margin-top: -10px"
									 disabled>
								</div>
							</div>

							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Descrição</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<input type="text" class="ba__input-modal" ng-model="preLancamentoSelecionado.descricao" style="text-transform:uppercase">
								</div>
								<h5 class="col-md-6 col-md-offset-1 text-gray"></h5>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Grupo de contas</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<select class="ba__input-select" ng-model="preLancamentoSelecionado.idGrupoLan" ng-change="filterPC(preLancamentoSelecionado.idGrupoLan)"
										ng-options="grp.id as grp.descricao for grp in grupoLancamentos">
									</select>
								</div>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Plano de contas</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<select class="ba__input-select" ng-disabled="data.lancamentoAvulsoSelecionado.id_lancamento" ng-model="preLancamentoSelecionado.idtipo_lancamento"
									 enter ng-options="planoConta.id as planoConta.descricao for planoConta in planoContas">
											</select>
								</div>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Quadra</h5>
								</div>
								<div class="col-md-3 col-md-offset-1">
									<input type="text" class="ba__input-modal" ng-model="data.search.Quadra">
								</div>
								<div class="col-md-3">
									<h5 class="text-right text-gray">Lote</h5>
								</div>
								<div class="col-md-3 col-md-offset-1">
									<input type="text" class="ba__input-modal" ng-model="data.search.Lote" ng-blur="getImoveisByQuadraAndLote()">
								</div>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Titular</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<span class="ba__input-modal">{{preLancamentoSelecionado.nome_titular}}</span>
								</div>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Valor</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<input ng-show="!preLancamentoSelecionado.valor_percentual"  type="text" class="ba__input-modal" ng-model="preLancamentoSelecionado.valor" style="text-transform:uppercase" ui-money-mask
										   placeholder="R$ 0,00">
									<input ng-show="preLancamentoSelecionado.valor_percentual" class="ba__input-modal" type="text" name="field" ng-model="preLancamentoSelecionado.valor" ui-percentage-mask ui-percentage-value placeholder="0,00%">
								</div>
								<div class="col-md-2 ba__margin-top-5">
									<div class="col-xs-7">
										<div class="onoffswitch">
											<input type="checkbox" name="onoffswitch" ng-change="switchOnOff()" checked class="onoffswitch-checkbox" enter ng-model="preLancamentoSelecionado.valor_percentual"
												   id="fixo">
											<label class="onoffswitch-label" for="fixo">
												<span class="onoffswitch-inner"></span>
												<span class="onoffswitch-switch"></span>
											</label>
										</div>
									</div>
								</div>
								<h5 >
									<span class="pull-left" style="font-size: 20px; margin-left: -10px; ">
										<span ng-show="preLancamentoSelecionado.valor_percentual" class="text-positive">%</span>
										<span ng-show="!preLancamentoSelecionado.valor_percentual">%</span>
									</span>
								</h5>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Mês / Ano</h5>
								</div>
								<div class="col-md-8 col-md-offset-1">
									<select ng-change="verificaMesAno(preLancamentoSelecionado)" class="ba__input-select" ng-model="preLancamentoSelecionado.mes" enter ng-options="meses.codigo as meses.nome for meses in data.meses">
										<option value="">Selecione o mês</option>
									</select>
								</div>
								<div class="col-md-3 col-md-offset-1">
									<input ng-blur="verificaMesAno(preLancamentoSelecionado)" type="number" placeholder="ANO" class="ba__input-modal" ng-model="preLancamentoSelecionado.ano" />
								</div>
							</div>
							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Desconto</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<input type="checkbox" class="ba__input-modal" ng-model="preLancamentoSelecionado.desconto" style="margin-top: 12px;">
								</div>
							</div>

							<div class="row ba__margin-bottom-30">
								<div class="col-md-6">
									<h5 class="text-right text-gray">Observação</h5>
								</div>
								<div class="col-md-10 col-md-offset-1">
									<textarea class="col-md-24" style="height: 100px; width: 100%; overflow-y: auto" ng-model="preLancamentoSelecionado.observacao"></textarea>
								</div>
							</div>

						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
                <button data-dismiss="modal" type="button" class="btn btn-default btn-clear col-xs-8 col-xs-offset-10">
                    Fechar
                </button>
                <button type="button" ng-click="savePreLancamento($event);" ng-if="accessPagina.inserir && !preLancamentoSelecionado.id_lancamento" class="btn btn-success col-md-5 pull-right" ng-disabled="validaCampo()">
                    Salvar
                </button>
                <button type="button" ng-click="savePreLancamento($event);" ng-if="accessPagina.editar && preLancamentoSelecionado.id_lancamento" class="btn btn-success col-md-5 pull-right" ng-disabled="validaCampo()">
                    Salvar
                </button>
			</div>
		</div>
	</div>
</div>

<!--MODAL EXCLUSAO-->
<div ng-keypress="$event.keyCode == 13 && deletePreLancamento()" class="modal fade" id="deleteAlert" tabindex="-1" role="dialog">
	<div class="modal-dialog ba__modal-loading" role="document">
		<div class="modal-content">
			<div class="modal-header ba__no-padding-top">
				<h4 class="col-xs-21 modal-title Roboto-Thin ba__font-size-25">
					<i class="icon-ba-attention text-center text-warning ba__margin-horizontal-5"></i>
					<span>Confirmação</span>
					<!--<span>Editando tipo de lançamento</span>-->
				</h4>
			</div>
			<div class="modal-body ba__modal-body-loading">
				<form>
					<div class="row ba__margin-top-30">
						<h5 class="col-md-24 text-gray ba__margin-top-20"><b>Deseja realmente concluir esta ação?</b></h5>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default btn-clear col-md-8 col-md-offset-7" ng-click="closeDeleteModal()">
						cancelar
					</button>
				<button type="button" class="btn btn-danger-full col-md-8 col-md-offset-1 pull-right" ng-click="deletePreLancamento()">
						DELETAR
					</button>
			</div>
		</div>
	</div>
</div>